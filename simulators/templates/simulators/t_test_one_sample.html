{% extends 'simulators/base.html' %}
{% load static %}

{% block title %}单样本t检验模拟器{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/simulators.css' %}">
<style>
    .simulator-container {
        width: 100%;
        margin: 0;
        padding: 15px;
        min-height: 100vh;
    }
    
    .control-panel {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .visualization-area {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        min-height: 400px;
    }
    
    .results-panel {
        background: #e8f4fd;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
    }
    
    .form-control {
        border-radius: 5px;
        border: 1px solid #ced4da;
        padding: 8px 12px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .results-table {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .results-table th {
        background: #495057;
        color: white;
        font-weight: 600;
        padding: 12px;
        text-align: center;
    }
    
    .results-table td {
        padding: 10px 12px;
        text-align: center;
        border-bottom: 1px solid #dee2e6;
    }
    
    .hypothesis-steps {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 5px 5px 0;
    }
    
    .step-title {
        font-weight: 600;
        color: #856404;
        margin-bottom: 8px;
    }
    
    .step-content {
        color: #664d03;
        line-height: 1.5;
    }
    
    #distributionChart {
        width: 100%;
        height: 350px;
    }
    
    .alert {
        border-radius: 8px;
        border: none;
        padding: 12px 16px;
        margin: 10px 0;
    }
    
    .alert-info {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .alert-success {
        background: #d4edda;
        color: #155724;
    }
    
    .alert-danger {
        background: #f8d7da;
        color: #721c24;
    }
</style>
{% endblock %}

{% block content %}
<div class="simulator-container">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">
                <i class="fas fa-chart-line me-2"></i>
                单样本t检验模拟器
            </h1>
            <p class="text-center text-muted mb-4">
                学习单样本t检验的基本原理，理解t分布与正态分布的差异，掌握小样本检验方法
            </p>
        </div>
    </div>

    <div class="row">
        <!-- 控制面板 -->
        <div class="col-md-4">
            <div class="control-panel">
                <h4 class="mb-3">
                    <i class="fas fa-sliders-h me-2"></i>
                    参数设置
                </h4>
                
                <!-- 假设设定 -->
                <div class="mb-4">
                    <h6 class="text-primary">假设设定</h6>
                    <div class="form-group">
                        <label class="form-label">原假设均值 (μ₀)</label>
                        <input type="number" id="mu0" class="form-control" value="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">检验类型</label>
                        <select id="testType" class="form-control">
                            <option value="two-tailed" selected>双侧检验 (μ ≠ μ₀)</option>
                            <option value="left-tailed">左侧检验 (μ < μ₀)</option>
                            <option value="right-tailed">右侧检验 (μ > μ₀)</option>
                        </select>
                    </div>
                </div>

                <!-- 总体参数 -->
                <div class="mb-4">
                    <h6 class="text-success">总体参数</h6>
                    <div class="form-group">
                        <label class="form-label">真实总体均值 (μ)</label>
                        <input type="number" id="trueMu" class="form-control" value="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">真实总体标准差 (σ)</label>
                        <input type="number" id="trueSigma" class="form-control" value="1" min="0.1" step="0.1">
                    </div>
                </div>

                <!-- 样本设置 -->
                <div class="mb-4">
                    <h6 class="text-warning">样本设置</h6>
                    <div class="form-group">
                        <label class="form-label">样本大小 (n)</label>
                        <input type="number" id="sampleSize" class="form-control" value="15" min="3" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">显著性水平 (α)</label>
                        <select id="alpha" class="form-control">
                            <option value="0.01">0.01</option>
                            <option value="0.05" selected>0.05</option>
                            <option value="0.10">0.10</option>
                        </select>
                    </div>
                </div>

                <!-- 假设检验步骤 -->
                <div class="hypothesis-steps mb-4">
                    <div class="step-title">假设检验步骤：</div>
                    <div class="step-content">
                        <strong>1. 提出假设，H₀:</strong> μ = μ₀ (总体均值等于假设值); 
                        <strong>H₁:</strong> <span id="alternativeHypothesis">μ ≠ μ₀ (总体均值不等于假设值);</span><br>
                        <strong>2. 选择显著性水平;</strong><br>
                        <strong>3. 计算检验统计量:</strong> t = (x̄ - μ₀)/(s/√n) ~ t(n-1);<br>
                        <strong>4. 做出统计推断:</strong> <span id="decisionRule">当p < α时拒绝H₀。</span>
                    </div>
                </div>

                <button id="runTest" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-play me-2"></i>
                    生成样本并执行检验
                </button>
                
                <button id="runSimulation" class="btn btn-success w-100 mb-2">
                    <i class="fas fa-chart-line me-2"></i>
                    重复模拟 (1000次)
                </button>
                
                <button id="resetSimulation" class="btn btn-warning w-100">
                    <i class="fas fa-redo me-2"></i>
                    重置模拟
                </button>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <strong>状态:</strong> <span id="simulationStatus">就绪</span>
                    </small>
                </div>
            </div>
        </div>

        <!-- 可视化区域 -->
        <div class="col-md-8">
            <div class="visualization-area">
                <h5 class="mb-3">
                    <i class="fas fa-chart-area me-2"></i>
                    t分布可视化
                </h5>
                <canvas id="distributionChart"></canvas>
            </div>

            <!-- 检验结果 -->
            <div class="results-panel mt-3">
                <h5 class="mb-3">
                    <i class="fas fa-calculator me-2"></i>
                    检验结果
                </h5>
                <div id="resultsContainer">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        点击"生成样本并执行检验"开始分析
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'vendor/chartjs/chart.js' %}"></script>
<script src="{% static 'js/t_test_one_sample.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const simulator = new TTestOneSampleSimulator();
});
</script>
{% endblock %}