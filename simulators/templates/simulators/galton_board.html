{% extends 'simulators/base.html' %}
{% load static %}

{% block title %}高尔顿板模拟器{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/simulators.css' %}">
<style>
    .simulator-container {
        width: 100%;
        margin: 0;
        padding: 15px;
        min-height: 100vh;
    }
    
    .control-panel {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .visualization-area {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        min-height: 400px;
    }
    
    .results-panel {
        background: #e8f4fd;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
    }
    
    .form-control, .form-range {
        border-radius: 5px;
        border: 1px solid #ced4da;
    }
    
    .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        border: none;
        border-radius: 25px;
        padding: 10px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .parameter-section {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 5px 5px 0;
    }
    
    .section-title {
        font-weight: 600;
        color: #856404;
        margin-bottom: 8px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin: 15px 0;
    }
    
    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-left: 4px solid #007bff;
    }
    
    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stat-label {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .theory-info {
        background: #d4edda;
        border-left: 4px solid #28a745;
        padding: 15px;
        margin: 15px 0;
        border-radius: 0 5px 5px 0;
    }
    
    .info-title {
        font-weight: 600;
        color: #155724;
        margin-bottom: 8px;
    }
    
    .info-content {
        color: #155724;
        line-height: 1.5;
        font-size: 0.9rem;
    }
    
    .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .card-header {
        background: #09529b;
        color: white;
        font-weight: 600;
        border-radius: 10px 10px 0 0 !important;
        padding: 15px 20px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    #galtonCanvas {
        border-radius: 5px;
        border: 1px solid #dee2e6;
    }
    
    #distributionChart {
        width: 100%;
        height: 300px;
    }
    
    .range-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 5px;
    }
    
    .range-value {
        font-weight: bold;
        color: #007bff;
        font-size: 1.1rem;
    }
    
    .detailed-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .detailed-stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-top: 4px solid #007bff;
    }
    
    .detailed-stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 8px;
    }
    
    .detailed-stat-label {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .simulator-container {
            padding: 10px;
        }
        
        .control-panel, .visualization-area, .results-panel {
            padding: 15px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .detailed-stats {
            grid-template-columns: 1fr 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="simulator-container">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">
                <i class="fas fa-chart-bar me-2"></i>
                高尔顿板模拟器
            </h1>
            <p class="text-center text-muted mb-4">
                观察小球通过钉板的随机过程，直观理解正态分布的形成机制和中心极限定理
            </p>
        </div>
    </div>

    <div class="row">
        <!-- 控制面板 -->
        <div class="col-md-3">
            <div class="control-panel">
                <h4 class="mb-3">
                    <i class="fas fa-sliders-h me-2"></i>
                    参数设置
                </h4>
                
                <!-- 基本参数 -->
                <div class="parameter-section">
                    <div class="section-title">基本参数</div>
                    <div class="form-group">
                        <label for="ballCount" class="form-label">小球数量</label>
                        <input type="range" class="form-range" id="ballCount" min="50" max="1000" value="200" step="50">
                        <div class="range-display">
                            <small>50</small>
                            <span id="ballCountValue" class="range-value">200</span>
                            <small>1000</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pegLayers" class="form-label">钉子层数</label>
                        <input type="range" class="form-range" id="pegLayers" min="8" max="15" value="12" step="1">
                        <div class="range-display">
                            <small>8</small>
                            <span id="pegLayersValue" class="range-value">12</span>
                            <small>15</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="animationSpeed" class="form-label">动画速度</label>
                        <input type="range" class="form-range" id="animationSpeed" min="1" max="10" value="5" step="1">
                        <div class="range-display">
                            <small>慢</small>
                            <span id="animationSpeedValue" class="range-value">5</span>
                            <small>快</small>
                        </div>
                    </div>
                </div>

                <!-- 控制按钮 -->
                <div class="parameter-section">
                    <div class="section-title">控制操作</div>
                    <div class="d-grid gap-2">
                        <button id="startBtn" class="btn btn-success">
                            <i class="fas fa-play me-2"></i>开始模拟
                        </button>
                        <button id="pauseBtn" class="btn btn-warning" disabled>
                            <i class="fas fa-pause me-2"></i>暂停
                        </button>
                        <button id="resetBtn" class="btn btn-danger">
                            <i class="fas fa-redo me-2"></i>重置
                        </button>
                    </div>
                </div>

                <!-- 实时统计 -->
                <div class="parameter-section">
                    <div class="section-title">实时统计</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value text-primary" id="droppedCount">0</div>
                            <div class="stat-label">已投放</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value text-success" id="collectedCount">0</div>
                            <div class="stat-label">已收集</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value text-info" id="meanValue">--</div>
                            <div class="stat-label">均值</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value text-warning" id="stdValue">--</div>
                            <div class="stat-label">标准差</div>
                        </div>
                    </div>
                </div>

                <!-- 理论说明 -->
                <div class="theory-info">
                    <div class="info-title">
                        <i class="fas fa-info-circle me-2"></i>理论背景
                    </div>
                    <div class="info-content">
                        高尔顿板展示了中心极限定理：大量独立随机事件的累积结果趋向于正态分布。
                        每个小球在每层钉子处都有50%的概率向左或向右，最终形成近似正态分布。
                    </div>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <strong>状态:</strong> <span id="simulationStatus">就绪</span>
                    </small>
                </div>
            </div>
        </div>

        <!-- 可视化主体 -->
        <div class="col-md-9">
            <div class="row">
                <!-- 高尔顿板画布 -->
                <div class="col-lg-6">
                    <div class="visualization-area">
                        <h5 class="mb-3">
                            <i class="fas fa-chart-area me-2"></i>
                            高尔顿板
                        </h5>
                        <canvas id="galtonCanvas" width="600" height="700" class="w-100"></canvas>
                    </div>
                </div>

                <!-- 统计图表 -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-chart-bar me-2"></i>
                                分布统计
                            </h6>
                        </div>
                        <div class="card-body">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>

                    <!-- 详细统计 -->
                    <div class="results-panel mt-3">
                        <h5 class="mb-3">
                            <i class="fas fa-calculator me-2"></i>
                            详细分析
                        </h5>
                        <div class="detailed-stats">
                            <div class="detailed-stat-card">
                                <div class="detailed-stat-value text-primary" id="detailMean">--</div>
                                <div class="detailed-stat-label">样本均值</div>
                            </div>
                            <div class="detailed-stat-card">
                                <div class="detailed-stat-value text-success" id="detailStd">--</div>
                                <div class="detailed-stat-label">样本标准差</div>
                            </div>
                            <div class="detailed-stat-card">
                                <div class="detailed-stat-value text-info" id="detailSkewness">--</div>
                                <div class="detailed-stat-label">偏度</div>
                            </div>
                            <div class="detailed-stat-card">
                                <div class="detailed-stat-value text-warning" id="detailKurtosis">--</div>
                                <div class="detailed-stat-label">峰度</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'vendor/chartjs/chart.js' %}"></script>
<script src="{% static 'js/galton_board.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 初始化模拟器状态
    document.getElementById('simulationStatus').textContent = '已加载';
});
</script>
{% endblock %}